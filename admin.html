<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width,initial-scale=1.0">
<title>Admin ‚Äî MovieNation</title>
<meta name="robots" content="noindex,nofollow">

<!-- LOGIN SCRIPT: defined FIRST before ANY external script can fail -->
<script>
var _EMAIL = 'tuyizereomega@gmail.com';
var _PASS  = 'tuyizere123@';
var _SKEY  = 'mn_admin_sess';
var _TTL   = 8 * 60 * 60 * 1000;

function doLogin() {
  var emailEl = document.getElementById('lock-email');
  var pwEl    = document.getElementById('lock-pw');
  var errEl   = document.getElementById('lock-err');
  if (!emailEl || !pwEl || !errEl) { alert('Page not ready yet. Please wait a moment.'); return; }
  var email = emailEl.value.trim().toLowerCase();
  var pw    = pwEl.value;
  errEl.style.display = 'none';
  if (!email) { errEl.textContent = 'Please enter your email.';    errEl.style.display = 'block'; return; }
  if (!pw)    { errEl.textContent = 'Please enter your password.'; errEl.style.display = 'block'; return; }
  if (email !== _EMAIL.toLowerCase()) { errEl.textContent = 'Email not found.';      errEl.style.display = 'block'; return; }
  if (pw    !== _PASS)                { errEl.textContent = 'Incorrect password.';   errEl.style.display = 'block'; return; }
  // ‚úì Correct ‚Äî save session and show admin
  try { localStorage.setItem(_SKEY, JSON.stringify({ts: Date.now()})); } catch(e) {}
  document.getElementById('lockscreen').style.display = 'none';
  // If DB is ready, refresh. Otherwise wait.
  if (typeof DB !== 'undefined') {
    DB.onReady(function() { if(typeof refreshAll==='function') refreshAll(); if(typeof renderSettings==='function') renderSettings(); });
  }
}
</script>

<script type="module">
  import { initializeApp } from "https://www.gstatic.com/firebasejs/9.23.0/firebase-app.js";
  import { getAuth, onAuthStateChanged } from "https://www.gstatic.com/firebasejs/9.23.0/firebase-auth.js";

  const firebaseConfig = {
    apiKey: "AIzaSyBkly_76tjXhBFhnTJ9cOtORoSOq1YGHP8",
    authDomain: "movienation-1.firebaseapp.com",
    projectId: "movienation-1",
    appId: "1:236535077737:web:9cab53046c037127e9fbf8"
  };

  const app = initializeApp(firebaseConfig);
  const auth = getAuth(app);

  const ADMIN_EMAIL = "tuyizereomega@gmail.com"; // ONLY YOU

  onAuthStateChanged(auth, user => {
    if (!user || user.email !== ADMIN_EMAIL) {
      window.location.href = "/login.html";
    }
  });
</script>

<link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Bebas+Neue&family=Outfit:wght@300;400;500;600;700;800&display=swap">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/remixicon/4.2.0/remixicon.min.css">
<style>
:root{
  --black:#07090f;--dark:#0d1119;--card:#111827;--card2:#161f2e;
  --border:rgba(255,255,255,.07);--brd2:rgba(255,255,255,.13);
  --amber:#f59e0b;--amb2:#fbbf24;
  --red:#ef4444;--green:#22c55e;--blue:#3b82f6;--purple:#8b5cf6;
  --text:#f1f5f9;--muted:#94a3b8;--muted2:#64748b;
  --sb:240px;--r:10px;--rl:16px;--rxl:20px;
  --ease:cubic-bezier(.4,0,.2,1);--spring:cubic-bezier(.34,1.56,.64,1);
  --ft:'Bebas Neue',sans-serif;--fb:'Outfit',sans-serif;
}
*,*::before,*::after{box-sizing:border-box;margin:0;padding:0}
html{-webkit-font-smoothing:antialiased;-webkit-tap-highlight-color:transparent}
body{font-family:var(--fb);background:var(--black);color:var(--text);min-height:100vh;display:flex;overflow-x:hidden}
a{text-decoration:none;color:inherit}
button{cursor:pointer;border:none;background:none;font-family:var(--fb);color:inherit}
input,textarea,select{font-family:var(--fb);color:var(--text)}
ul{list-style:none}
::selection{background:var(--amber);color:#000}
::-webkit-scrollbar{width:4px}
::-webkit-scrollbar-thumb{background:var(--amber);border-radius:4px}

/* ‚îÄ‚îÄ LOCK SCREEN ‚îÄ‚îÄ */
#lockscreen{
  position:fixed;inset:0;z-index:9999;
  background:var(--black);
  display:flex;align-items:center;justify-content:center;padding:20px;
}
.lock-box{
  background:var(--card);border:1px solid var(--brd2);border-radius:var(--rxl);
  padding:clamp(28px,5vw,48px) clamp(24px,5vw,40px);
  width:100%;max-width:400px;text-align:center;
  box-shadow:0 32px 80px rgba(0,0,0,.7);position:relative;overflow:hidden;
}
.lock-box::before{content:'';position:absolute;top:0;left:0;right:0;height:3px;background:linear-gradient(90deg,var(--amber),var(--amb2),var(--red));border-radius:var(--rxl) var(--rxl) 0 0}
.lock-logo{font-family:var(--ft);font-size:.9rem;letter-spacing:4px;color:var(--amb2);display:block;margin-bottom:22px}
.lock-icon{width:64px;height:64px;border-radius:50%;background:rgba(245,158,11,.1);border:2px solid rgba(245,158,11,.25);display:flex;align-items:center;justify-content:center;margin:0 auto 16px;font-size:1.7rem;color:var(--amber)}
.lock-title{font-family:var(--ft);font-size:1.7rem;letter-spacing:1px;margin-bottom:6px}
.lock-sub{color:var(--muted);font-size:.83rem;margin-bottom:24px;line-height:1.5}
.lock-err{background:rgba(239,68,68,.09);border:1px solid rgba(239,68,68,.25);border-radius:8px;padding:9px 13px;font-size:.8rem;color:#f87171;margin-bottom:14px;display:none;text-align:left}
.lfi{
  width:100%;background:var(--card2);border:2px solid var(--brd2);border-radius:var(--r);
  padding:12px 14px;font-size:.9rem;margin-bottom:12px;
  outline:none;transition:border-color .2s,box-shadow .2s;
  color:var(--text);
}
.lfi:focus{border-color:var(--amber);box-shadow:0 0 0 3px rgba(245,158,11,.15)}
.lfi::placeholder{color:var(--muted2)}
.lbtn{
  width:100%;padding:14px;border-radius:var(--r);
  background:var(--amber);color:#000;font-weight:800;font-size:.95rem;
  cursor:pointer;border:none;font-family:var(--fb);
  box-shadow:0 4px 20px rgba(245,158,11,.4);transition:.2s;
  display:flex;align-items:center;justify-content:center;gap:8px;
}
.lbtn:hover{transform:translateY(-2px);box-shadow:0 8px 28px rgba(245,158,11,.55)}
.lbtn:active{transform:translateY(0)}
.lock-info{margin-top:16px;padding:12px;background:var(--card2);border-radius:8px;text-align:left;font-size:.78rem;line-height:1.9;color:var(--muted)}
.lock-info strong{color:var(--amb2)}
.lock-back{margin-top:14px;font-size:.8rem;color:var(--muted2)}
.lock-back a{color:var(--amb2);font-weight:600}

/* ‚îÄ‚îÄ SIDEBAR ‚îÄ‚îÄ */
#sidebar{width:var(--sb);flex-shrink:0;background:var(--dark);border-right:1px solid var(--border);display:flex;flex-direction:column;position:fixed;top:0;left:0;bottom:0;z-index:200;transition:transform .35s var(--ease)}
.sb-logo{padding:18px 16px;border-bottom:1px solid var(--border);display:flex;align-items:center;gap:9px;flex-shrink:0}
.sb-logo-txt{font-family:var(--ft);font-size:1.05rem;letter-spacing:3px;color:var(--amber)}
.sb-badge{font-size:.55rem;font-weight:700;letter-spacing:1px;text-transform:uppercase;padding:2px 7px;border-radius:50px;background:rgba(245,158,11,.15);color:var(--amb2);margin-left:auto;white-space:nowrap}
.sb-nav{flex:1;padding:10px;overflow-y:auto;display:flex;flex-direction:column;gap:2px}
.sb-sec{font-size:.57rem;font-weight:700;letter-spacing:3px;text-transform:uppercase;color:var(--muted2);padding:10px 10px 4px;margin-top:6px}
.sb-btn{display:flex;align-items:center;gap:10px;padding:9px 12px;border-radius:var(--r);font-size:.82rem;font-weight:500;color:var(--muted);cursor:pointer;transition:.2s;background:none;border:none;width:100%;text-align:left}
.sb-btn:hover{background:var(--border);color:var(--text)}
.sb-btn.on{background:rgba(245,158,11,.12);color:var(--amb2);font-weight:700}
.sb-btn i{font-size:1rem;width:18px;flex-shrink:0}
.sb-count{margin-left:auto;background:var(--card2);padding:1px 7px;border-radius:50px;font-size:.65rem;color:var(--muted2)}
.sb-btn.on .sb-count{background:rgba(245,158,11,.15);color:var(--amb2)}
.sb-foot{padding:12px;border-top:1px solid var(--border);flex-shrink:0}
.sb-user{display:flex;align-items:center;gap:9px;padding:10px;border-radius:var(--r);background:var(--card);border:1px solid var(--border)}
.sb-av{width:32px;height:32px;border-radius:50%;background:linear-gradient(135deg,var(--amber),var(--red));display:flex;align-items:center;justify-content:center;font-weight:800;font-size:.8rem;color:#000;flex-shrink:0}
.sb-name{font-size:.8rem;font-weight:700;white-space:nowrap;overflow:hidden;text-overflow:ellipsis}
.sb-role{font-size:.65rem;color:var(--amb2);font-weight:700}
.sb-out{margin-left:auto;color:var(--muted2);font-size:1rem;padding:4px;transition:.2s;cursor:pointer;flex-shrink:0;background:none;border:none}
.sb-out:hover{color:#f87171}

/* ‚îÄ‚îÄ MAIN ‚îÄ‚îÄ */
#main{margin-left:var(--sb);flex:1;min-height:100vh;display:flex;flex-direction:column}
.topbar{position:sticky;top:0;z-index:100;background:rgba(7,9,15,.9);backdrop-filter:blur(16px);border-bottom:1px solid var(--border);padding:0 clamp(14px,3vw,28px);height:60px;display:flex;align-items:center;justify-content:space-between;gap:12px}
.tb-left{display:flex;align-items:center;gap:12px}
.tb-title{font-family:var(--ft);font-size:1.5rem;letter-spacing:1px}
.tb-right{display:flex;align-items:center;gap:8px}
.tb-btn{display:inline-flex;align-items:center;gap:7px;padding:7px 16px;border-radius:50px;font-size:.78rem;font-weight:700;cursor:pointer;transition:.2s;border:none;font-family:var(--fb)}
.tb-amber{background:var(--amber);color:#000;box-shadow:0 4px 14px rgba(245,158,11,.3)}
.tb-amber:hover{transform:translateY(-2px)}
.tb-ghost{background:var(--card);border:1px solid var(--brd2);color:var(--muted)}
.tb-ghost:hover{color:var(--text)}
#burger-admin{display:none;padding:6px;font-size:1.2rem;color:var(--muted);cursor:pointer;background:none;border:none}

/* ‚îÄ‚îÄ PAGES ‚îÄ‚îÄ */
.pg{display:none;padding:clamp(14px,3vw,28px);flex:1}
.pg.on{display:block}

/* ‚îÄ‚îÄ STAT CARDS ‚îÄ‚îÄ */
.stats-row{display:grid;grid-template-columns:repeat(4,1fr);gap:14px;margin-bottom:24px}
.sc{background:var(--card);border:1px solid var(--border);border-radius:var(--rl);padding:18px;transition:.3s}
.sc:hover{border-color:var(--brd2);transform:translateY(-3px)}
.sc-icon{width:38px;height:38px;border-radius:9px;display:flex;align-items:center;justify-content:center;font-size:1rem;margin-bottom:12px}
.ic-a{background:rgba(245,158,11,.12);color:var(--amber)}
.ic-g{background:rgba(34,197,94,.1);color:var(--green)}
.ic-b{background:rgba(59,130,246,.1);color:var(--blue)}
.ic-p{background:rgba(139,92,246,.1);color:var(--purple)}
.sc-n{font-family:var(--ft);font-size:2rem;line-height:1;margin-bottom:4px;display:block}
.sc-l{font-size:.72rem;color:var(--muted)}

/* ‚îÄ‚îÄ SECTION HEADER ‚îÄ‚îÄ */
.sh{display:flex;align-items:center;justify-content:space-between;margin-bottom:16px;gap:10px;flex-wrap:wrap}
.sh h3{font-family:var(--ft);font-size:1.2rem;letter-spacing:1px}
.sh-tag{font-size:.65rem;font-weight:700;letter-spacing:1px;text-transform:uppercase;padding:3px 9px;border-radius:50px;background:var(--card2);color:var(--muted2);border:1px solid var(--border)}

/* ‚îÄ‚îÄ CHART CARDS ‚îÄ‚îÄ */
.chart-row{display:grid;grid-template-columns:1fr 1fr;gap:18px;margin-bottom:24px}
.cc{background:var(--card);border:1px solid var(--border);border-radius:var(--rxl);padding:20px}
.cc-title{font-size:.62rem;font-weight:700;letter-spacing:3px;text-transform:uppercase;color:var(--muted2);margin-bottom:14px}
.gbar{margin-bottom:8px}
.gbar-top{display:flex;justify-content:space-between;font-size:.74rem;color:var(--muted);margin-bottom:4px}
.gbar-top span:first-child{color:var(--text);font-weight:500}
.gbar-track{height:5px;background:var(--card2);border-radius:5px;overflow:hidden}
.gbar-fill{height:100%;border-radius:5px;background:linear-gradient(90deg,var(--amber),var(--amb2));transition:width .8s var(--ease)}
.recent-list{display:flex;flex-direction:column;gap:7px}
.rl-item{display:flex;align-items:center;gap:10px;padding:8px;border-radius:var(--r);background:var(--card2);border:1px solid var(--border);cursor:pointer;transition:.2s}
.rl-item:hover{border-color:var(--brd2)}
.rl-img{width:34px;height:50px;border-radius:5px;object-fit:cover;border:1px solid var(--border);flex-shrink:0}
.rl-info{flex:1;min-width:0}
.rl-title{font-weight:600;font-size:.8rem;white-space:nowrap;overflow:hidden;text-overflow:ellipsis}
.rl-meta{font-size:.7rem;color:var(--muted);margin-top:2px}

/* ‚îÄ‚îÄ TABLE ‚îÄ‚îÄ */
.tbl-wrap{background:var(--card);border:1px solid var(--border);border-radius:var(--rxl);overflow:hidden}
.tbl-toolbar{padding:12px 16px;display:flex;align-items:center;gap:9px;border-bottom:1px solid var(--border);flex-wrap:wrap}
.tbl-search{position:relative;flex:1;min-width:140px;max-width:280px}
.tbl-search input{width:100%;background:var(--card2);border:1px solid var(--brd2);border-radius:50px;padding:8px 14px 8px 34px;color:var(--text);font-size:.82rem;outline:none;transition:.2s}
.tbl-search input:focus{border-color:var(--amber)}
.tbl-search input::placeholder{color:var(--muted2)}
.tbl-search i{position:absolute;left:12px;top:50%;transform:translateY(-50%);color:var(--muted2);font-size:.88rem;pointer-events:none}
.tbl-sel{padding:7px 26px 7px 11px;border-radius:50px;background:var(--card2);border:1px solid var(--brd2);color:var(--text);font-size:.77rem;cursor:pointer;appearance:none;background-image:url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' fill='%2364748b' viewBox='0 0 16 16'%3E%3Cpath d='M7.247 11.14L2.451 5.658C1.885 5.013 2.345 4 3.204 4h9.592a1 1 0 0 1 .753 1.659l-4.796 5.48a1 1 0 0 1-1.506 0z'/%3E%3C/svg%3E");background-repeat:no-repeat;background-position:right 8px center;background-size:8px;outline:none}
.tbl-sel:focus{border-color:var(--amber)}
.tbl-scroll{overflow-x:auto}
table{width:100%;border-collapse:collapse}
thead th{padding:10px 13px;text-align:left;font-size:.6rem;font-weight:700;letter-spacing:2px;text-transform:uppercase;color:var(--muted2);background:var(--card2);border-bottom:1px solid var(--border);white-space:nowrap}
tbody tr{border-bottom:1px solid var(--border);transition:background .15s}
tbody tr:last-child{border-bottom:none}
tbody tr:hover{background:rgba(255,255,255,.025)}
td{padding:10px 13px;font-size:.82rem;vertical-align:middle}
.td-poster{width:34px;height:50px;border-radius:5px;object-fit:cover;border:1px solid var(--brd2)}
.td-title{font-weight:700;max-width:180px;white-space:nowrap;overflow:hidden;text-overflow:ellipsis}
.td-sub{font-size:.7rem;color:var(--muted);font-weight:400;margin-top:1px;white-space:nowrap;overflow:hidden;text-overflow:ellipsis}
.td-genres{display:flex;gap:4px;flex-wrap:wrap}
.td-genre{background:var(--card2);border:1px solid var(--border);padding:2px 7px;border-radius:50px;font-size:.62rem;color:var(--muted);white-space:nowrap}
.td-badge{padding:3px 8px;border-radius:50px;font-size:.62rem;font-weight:700;text-transform:uppercase;display:inline-block;white-space:nowrap}
.bd-top{background:rgba(245,158,11,.15);color:var(--amb2)}
.bd-new{background:rgba(34,197,94,.12);color:#4ade80}
.bd-soon{background:rgba(239,68,68,.12);color:#f87171}
.bd-feat{background:rgba(139,92,246,.12);color:#a78bfa}
.bd-none{background:var(--card2);color:var(--muted2)}
.td-rating{font-weight:700;color:var(--amb2);white-space:nowrap}
.td-actions{display:flex;gap:5px}
.act{width:30px;height:30px;border-radius:7px;display:flex;align-items:center;justify-content:center;font-size:.85rem;transition:.2s;cursor:pointer;background:var(--card2);border:1px solid var(--brd2);color:var(--muted)}
.act-view:hover{background:rgba(59,130,246,.12);color:#60a5fa;border-color:#60a5fa}
.act-feat:hover,.act-feat.is-feat{background:rgba(139,92,246,.15);color:#a78bfa;border-color:#a78bfa}
.act-edit:hover{background:rgba(245,158,11,.12);color:var(--amb2);border-color:var(--amb2)}
.act-del:hover{background:rgba(239,68,68,.12);color:#f87171;border-color:#f87171}
.tbl-empty{padding:54px;text-align:center;color:var(--muted2);font-size:.9rem}
.tbl-empty i{font-size:2.2rem;display:block;margin-bottom:10px;opacity:.3}
.pagination{display:flex;align-items:center;justify-content:space-between;padding:12px 16px;border-top:1px solid var(--border);flex-wrap:wrap;gap:8px}
.pg-info{font-size:.76rem;color:var(--muted)}
.pg-btns{display:flex;gap:4px;flex-wrap:wrap}
.pg-btn{min-width:32px;height:32px;padding:0 8px;border-radius:7px;display:flex;align-items:center;justify-content:center;font-size:.8rem;font-weight:600;background:var(--card2);border:1px solid var(--brd2);color:var(--muted);cursor:pointer;transition:.2s}
.pg-btn:hover{border-color:var(--amb2);color:var(--amb2)}
.pg-btn.on{background:var(--amber);color:#000;border-color:var(--amber)}
.pg-btn:disabled{opacity:.35;cursor:not-allowed}

/* ‚îÄ‚îÄ FORM MODAL ‚îÄ‚îÄ */
.modal-bg{position:fixed;inset:0;z-index:500;background:rgba(7,9,15,.88);backdrop-filter:blur(12px);display:none;align-items:center;justify-content:center;padding:16px}
.modal-bg.open{display:flex}
.modal-box{background:var(--card);border:1px solid var(--brd2);border-radius:var(--rxl);width:100%;max-width:800px;max-height:92svh;overflow:hidden;display:flex;flex-direction:column;box-shadow:0 32px 80px rgba(0,0,0,.7)}
.modal-head{padding:16px 20px;border-bottom:1px solid var(--border);display:flex;align-items:center;justify-content:space-between;flex-shrink:0}
.modal-head h2{font-family:var(--ft);font-size:1.4rem;letter-spacing:1px}
.modal-close{width:30px;height:30px;border-radius:50%;background:var(--card2);border:1px solid var(--brd2);color:var(--muted);display:flex;align-items:center;justify-content:center;font-size:.9rem;cursor:pointer;transition:.2s}
.modal-close:hover{background:var(--red);color:#fff;border-color:var(--red)}
.modal-body{padding:20px;overflow-y:auto;flex:1}
.modal-foot{padding:13px 20px;border-top:1px solid var(--border);display:flex;justify-content:flex-end;gap:9px;flex-shrink:0;background:var(--card)}
.fgrid{display:grid;grid-template-columns:1fr 1fr;gap:13px;margin-bottom:13px}
.fgrid-3{display:grid;grid-template-columns:1fr 1fr 1fr;gap:13px;margin-bottom:13px}
.fg{display:flex;flex-direction:column;gap:5px}
.fg label{font-size:.6rem;font-weight:700;letter-spacing:2px;text-transform:uppercase;color:var(--muted2)}
.fi{background:var(--card2);border:1px solid var(--brd2);border-radius:var(--r);padding:10px 12px;font-size:.86rem;width:100%;outline:none;transition:border-color .2s}
.fi:focus{border-color:var(--amber)}
.fi::placeholder{color:var(--muted2)}
.fi.ta{min-height:78px;resize:vertical}
.fg-hint{font-size:.67rem;color:var(--muted2)}
.toggles{display:flex;gap:14px;flex-wrap:wrap;margin-top:6px}
.tog{display:flex;align-items:center;gap:7px;cursor:pointer;user-select:none}
.tog input[type=checkbox]{width:34px;height:18px;appearance:none;background:var(--card2);border:1px solid var(--brd2);border-radius:50px;cursor:pointer;transition:.25s;position:relative;flex-shrink:0}
.tog input[type=checkbox]::before{content:'';position:absolute;width:13px;height:13px;border-radius:50%;background:var(--muted2);top:2px;left:2px;transition:.25s}
.tog input[type=checkbox]:checked{background:rgba(245,158,11,.15);border-color:var(--amber)}
.tog input[type=checkbox]:checked::before{background:var(--amber);left:17px}
.tog-lbl{font-size:.82rem;font-weight:600;color:var(--muted)}
.img-prev{width:100%;height:120px;border-radius:var(--r);border:2px dashed var(--brd2);background:var(--card2);display:flex;align-items:center;justify-content:center;color:var(--muted2);font-size:.75rem;gap:6px;overflow:hidden;margin-top:5px}
.img-prev img{width:100%;height:100%;object-fit:cover;display:none}
.img-prev.has img{display:block}
.img-prev.has i,.img-prev.has span{display:none}
.fbtn{display:inline-flex;align-items:center;gap:7px;padding:9px 18px;border-radius:50px;font-size:.84rem;font-weight:700;cursor:pointer;transition:.2s;border:none;font-family:var(--fb)}
.fbtn-amber{background:var(--amber);color:#000}
.fbtn-amber:hover{transform:translateY(-2px)}
.fbtn-red{background:rgba(239,68,68,.12);color:#f87171;border:1px solid rgba(239,68,68,.3)}
.fbtn-red:hover{background:var(--red);color:#fff;border-color:var(--red)}
.fbtn-ghost{background:var(--card2);border:1px solid var(--brd2);color:var(--muted)}
.fbtn-ghost:hover{color:var(--text)}
.fbtn:disabled{opacity:.5;cursor:not-allowed}

/* ‚îÄ‚îÄ CONFIRM MODAL ‚îÄ‚îÄ */
.cfm-bg{position:fixed;inset:0;z-index:600;background:rgba(7,9,15,.88);backdrop-filter:blur(12px);display:none;align-items:center;justify-content:center;padding:20px}
.cfm-bg.open{display:flex}
.cfm-box{background:var(--card);border:1px solid var(--brd2);border-radius:var(--rxl);padding:30px;max-width:340px;width:100%;text-align:center;box-shadow:0 24px 60px rgba(0,0,0,.7)}
.cfm-icon{width:50px;height:50px;border-radius:50%;background:rgba(239,68,68,.1);border:2px solid rgba(239,68,68,.25);display:flex;align-items:center;justify-content:center;margin:0 auto 14px;font-size:1.4rem;color:#f87171}
.cfm-title{font-family:var(--ft);font-size:1.3rem;letter-spacing:1px;margin-bottom:7px}
.cfm-msg{color:var(--muted);font-size:.84rem;line-height:1.65;margin-bottom:20px}
.cfm-btns{display:flex;gap:10px;justify-content:center}

/* ‚îÄ‚îÄ ACTIVITY ‚îÄ‚îÄ */
.log-list{display:flex;flex-direction:column;gap:3px}
.li{display:flex;align-items:center;gap:11px;padding:10px 13px;border-radius:var(--r);background:var(--card);border:1px solid var(--border);font-size:.82rem}
.li-dot{width:7px;height:7px;border-radius:50%;flex-shrink:0}
.li.la .li-dot{background:var(--green)}
.li.lu .li-dot{background:var(--amber)}
.li.ld .li-dot{background:var(--red)}
.li.lr .li-dot{background:var(--purple)}
.li-act{font-weight:700;flex-shrink:0;min-width:58px;font-size:.78rem}
.li-movie{flex:1;color:var(--muted);overflow:hidden;text-overflow:ellipsis;white-space:nowrap}
.li-ts{font-size:.68rem;color:var(--muted2);white-space:nowrap;flex-shrink:0}

/* ‚îÄ‚îÄ SETTINGS ‚îÄ‚îÄ */
.set-card{background:var(--card);border:1px solid var(--border);border-radius:var(--rxl);padding:clamp(16px,3vw,24px);margin-bottom:16px}
.set-card-title{font-size:.62rem;font-weight:700;letter-spacing:3px;text-transform:uppercase;color:var(--muted2);margin-bottom:13px}
.how-list{display:flex;flex-direction:column;gap:9px}
.how-item{display:flex;gap:11px;align-items:flex-start;padding:10px;background:var(--card2);border-radius:var(--r);font-size:.82rem}
.how-num{width:22px;height:22px;border-radius:50%;background:rgba(245,158,11,.15);color:var(--amb2);font-weight:800;font-size:.72rem;display:flex;align-items:center;justify-content:center;flex-shrink:0;margin-top:2px}
.how-item p{color:var(--muted);line-height:1.65}
.how-item strong{color:var(--text)}
code{background:var(--card2);padding:2px 6px;border-radius:4px;font-size:.78rem;font-family:monospace;color:var(--amb2)}

/* ‚îÄ‚îÄ TOAST ‚îÄ‚îÄ */
#toasts{position:fixed;bottom:20px;right:20px;z-index:10000;display:flex;flex-direction:column;gap:7px;pointer-events:none}
.toast{background:var(--card);border:1px solid var(--brd2);border-radius:var(--rl);padding:11px 14px;box-shadow:0 8px 30px rgba(0,0,0,.5);display:flex;align-items:center;gap:10px;min-width:210px;max-width:290px;pointer-events:all;animation:tIn .3s var(--spring);font-size:.82rem}
.toast.success{border-left:4px solid var(--green)}.toast.error{border-left:4px solid var(--red)}.toast.info{border-left:4px solid var(--blue)}.toast.warn{border-left:4px solid var(--amber)}
.toast.success i{color:var(--green)}.toast.error i{color:#f87171}.toast.info i{color:#60a5fa}.toast.warn i{color:var(--amb2)}
@keyframes tIn{from{transform:translateX(110%);opacity:0}to{transform:none;opacity:1}}

/* ‚îÄ‚îÄ RESPONSIVE ‚îÄ‚îÄ */
@media(max-width:1100px){.stats-row{grid-template-columns:repeat(2,1fr)}.chart-row{grid-template-columns:1fr}.fgrid-3{grid-template-columns:1fr 1fr}}
@media(max-width:800px){:root{--sb:0px}#sidebar{width:240px;transform:translateX(-100%)}#sidebar.open{transform:none;box-shadow:8px 0 40px rgba(0,0,0,.5)}#main{margin-left:0}#burger-admin{display:block}.fgrid,.fgrid-3{grid-template-columns:1fr}.pg{padding:12px}.topbar{padding:0 12px}}
@media(max-width:540px){.stats-row{grid-template-columns:1fr 1fr}}
</style>
</head>
<body>

<!-- ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
     LOCK SCREEN ‚Äî completely self-contained
     No external JS needed for this to work
‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê -->
<div id="lockscreen">
  <div class="lock-box">
    <span class="lock-logo">MOVIENATION</span>
    <div class="lock-icon"><i class="ri-shield-keyhole-line"></i></div>
    <h2 class="lock-title">Admin Panel</h2>
    <p class="lock-sub">Sign in to manage movies, update content and push changes live.</p>
    <div class="lock-err" id="lock-err"></div>
    <input class="lfi" type="email" id="lock-email" placeholder="Email address" autocomplete="email" onkeydown="if(event.key==='Enter')document.getElementById('lock-pw').focus()">
    <input class="lfi" type="password" id="lock-pw" placeholder="Password" autocomplete="current-password" onkeydown="if(event.key==='Enter')doLogin()">
    <button class="lbtn" type="button" onclick="doLogin()">
      <i class="ri-login-box-line"></i>Sign In to Admin Panel
    </button>
    <div class="lock-info">
      <strong>Admin credentials</strong><br>
      Email: tuyizereomega@gmail.com<br>
      Password: tuyizere123@
    </div>
    <p class="lock-back"><a href="index.html"><i class="ri-arrow-left-line"></i> Back to website</a></p>
  </div>
</div>

<!-- ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
     ADMIN UI (hidden until logged in)
‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê -->
<aside id="sidebar">
  <div class="sb-logo">
    <i class="ri-film-fill" style="color:var(--amber);font-size:1.1rem;flex-shrink:0"></i>
    <span class="sb-logo-txt">MOVIENATION</span>
    <span class="sb-badge" id="db-mode-badge">Admin</span>
  </div>
  <nav class="sb-nav">
    <div class="sb-sec">Main</div>
    <button class="sb-btn on" onclick="goto('dashboard')"><i class="ri-dashboard-line"></i>Dashboard</button>
    <div class="sb-sec">Movies</div>
    <button class="sb-btn" onclick="goto('movies')"><i class="ri-film-line"></i>All Movies<span class="sb-count" id="cnt-all">‚Äî</span></button>
    <button class="sb-btn" onclick="goto('movies');setFilter('featured')"><i class="ri-star-line"></i>Featured<span class="sb-count" id="cnt-feat">‚Äî</span></button>
    <button class="sb-btn" onclick="goto('movies');setFilter('upcoming')"><i class="ri-time-line"></i>Upcoming<span class="sb-count" id="cnt-up">‚Äî</span></button>
    <button class="sb-btn" onclick="goto('movies');setFilter('new')"><i class="ri-sparkling-line"></i>New Releases<span class="sb-count" id="cnt-new">‚Äî</span></button>
    <button class="sb-btn" onclick="openAdd()"><i class="ri-add-circle-line"></i>Add New Movie</button>
    <div class="sb-sec">Data</div>
    <button class="sb-btn" onclick="goto('activity')"><i class="ri-history-line"></i>Activity Log</button>
    <button class="sb-btn" onclick="goto('settings')"><i class="ri-settings-3-line"></i>Settings &amp; Firebase</button>
    <button class="sb-btn" onclick="DB.exportJSON();toast('Exported!','success')"><i class="ri-download-2-line"></i>Export JSON</button>
    <div class="sb-sec">Site</div>
    <button class="sb-btn" onclick="window.open('index.html','_blank')"><i class="ri-external-link-line"></i>View Live Site</button>
  </nav>
  <div class="sb-foot">
    <div class="sb-user">
      <div class="sb-av">T</div>
      <div style="min-width:0">
        <div class="sb-name">Omega Admin</div>
        <div class="sb-role">Administrator</div>
      </div>
      <button class="sb-out" onclick="doLogout()" title="Sign out"><i class="ri-logout-box-r-line"></i></button>
    </div>
  </div>
</aside>

<div id="main">
  <div class="topbar">
    <div class="tb-left">
      <button id="burger-admin" onclick="document.getElementById('sidebar').classList.toggle('open')"><i class="ri-menu-line"></i></button>
      <div class="tb-title" id="tb-title">Dashboard</div>
    </div>
    <div class="tb-right">
      <button class="tb-btn tb-ghost" onclick="refreshAll()"><i class="ri-refresh-line"></i>Refresh</button>
      <button class="tb-btn tb-amber" onclick="openAdd()"><i class="ri-add-line"></i>Add Movie</button>
    </div>
  </div>

  <!-- DASHBOARD -->
  <div class="pg on" id="pg-dashboard">
    <div class="stats-row" id="dash-stats"></div>
    <div class="chart-row">
      <div class="cc"><div class="cc-title">Movies by Genre</div><div id="genre-bars"></div></div>
      <div class="cc"><div class="cc-title">Recently Added</div><div class="recent-list" id="recent-list"></div></div>
    </div>
    <div class="sh"><div style="display:flex;align-items:center;gap:10px"><h3>Recent Activity</h3><span class="sh-tag">Last 10</span></div></div>
    <div class="log-list" id="dash-log"></div>
  </div>

  <!-- MOVIES TABLE -->
  <div class="pg" id="pg-movies">
    <div class="tbl-wrap">
      <div class="tbl-toolbar">
        <div class="tbl-search"><i class="ri-search-line"></i><input type="text" id="tbl-q" placeholder="Search title, director..." oninput="renderTable()"></div>
        <select class="tbl-sel" id="tbl-status" onchange="renderTable()">
          <option value="">All Status</option>
          <option value="featured">Featured</option>
          <option value="new">New Release</option>
          <option value="upcoming">Upcoming</option>
          <option value="top">Top Rated (8+)</option>
        </select>
        <select class="tbl-sel" id="tbl-genre" onchange="renderTable()"><option value="">All Genres</option></select>
        <button class="tb-btn tb-amber" onclick="openAdd()" style="margin-left:auto"><i class="ri-add-line"></i>Add Movie</button>
      </div>
      <div class="tbl-scroll">
        <table>
          <thead><tr><th>Poster</th><th>Title / Director</th><th>Year</th><th>Genres</th><th>Rating</th><th>Status</th><th>Actions</th></tr></thead>
          <tbody id="tbl-body"></tbody>
        </table>
        <div class="tbl-empty" id="tbl-empty" style="display:none"><i class="ri-film-line"></i>No movies found</div>
      </div>
      <div class="pagination"><span class="pg-info" id="pg-info"></span><div class="pg-btns" id="pg-btns"></div></div>
    </div>
  </div>

  <!-- ACTIVITY -->
  <div class="pg" id="pg-activity">
    <div class="sh">
      <div style="display:flex;align-items:center;gap:10px"><h3>Activity Log</h3><span class="sh-tag" id="log-cnt">0 entries</span></div>
      <button class="fbtn fbtn-ghost" onclick="clearLog()"><i class="ri-delete-bin-line"></i>Clear Log</button>
    </div>
    <div class="log-list" id="full-log"></div>
  </div>

  <!-- SETTINGS -->
  <div class="pg" id="pg-settings">
    <div style="max-width:620px">
      <div class="set-card">
        <div class="set-card-title">üì° Database Status</div>
        <div id="db-status-msg" style="font-size:.84rem;color:var(--muted);line-height:1.7">Checking‚Ä¶</div>
      </div>
      <div class="set-card">
        <div class="set-card-title" style="display:flex;align-items:center;justify-content:space-between;flex-wrap:wrap;gap:8px">
          <span>üî• Connect Firebase ‚Äî Changes Go Live Instantly</span>
          <a href="https://console.firebase.google.com" target="_blank" style="font-size:.72rem;color:var(--amb2);font-weight:700;white-space:nowrap">Open Firebase ‚Üó</a>
        </div>
        <div style="background:rgba(34,197,94,.07);border:1px solid rgba(34,197,94,.18);border-radius:var(--r);padding:12px 14px;margin-bottom:16px;font-size:.82rem;line-height:1.75;color:var(--muted)">
          ‚úÖ Once connected, every movie you <strong style="color:var(--text)">add, edit or delete</strong> in this admin panel appears <strong style="color:var(--green)">instantly on your live website</strong> for all visitors worldwide ‚Äî no file uploads needed.
        </div>
        <div class="how-list" style="margin-bottom:18px">
          <div class="how-item"><div class="how-num">1</div><p>Go to <a href="https://console.firebase.google.com" target="_blank" style="color:var(--amb2);font-weight:700">console.firebase.google.com</a> ‚Üí <strong>Add project</strong> ‚Üí give it any name ‚Üí click through ‚Üí Create</p></div>
          <div class="how-item"><div class="how-num">2</div><p>In your project: <strong>Build ‚Üí Firestore Database ‚Üí Create database</strong> ‚Üí select <strong>Test mode</strong> ‚Üí choose a region ‚Üí Enable</p></div>
          <div class="how-item"><div class="how-num">3</div><p>Click <strong>‚öôÔ∏è Project Settings</strong> ‚Üí <strong>Your apps</strong> ‚Üí <code>&lt;/&gt;</code> Web ‚Üí Register ‚Üí copy the <code>firebaseConfig</code> block ‚Üí paste below</p></div>
        </div>
        <div class="fg" style="margin-bottom:13px">
          <label>Paste your Firebase Config here</label>
          <textarea class="fi ta" id="fb-paste" rows="7" style="font-family:monospace;font-size:.77rem;min-height:140px" placeholder="Paste the firebaseConfig object from Firebase console, e.g.:

{
  apiKey: &quot;AIzaSy...&quot;,
  authDomain: &quot;myapp.firebaseapp.com&quot;,
  projectId: &quot;myapp-12345&quot;,
  storageBucket: &quot;myapp.appspot.com&quot;,
  messagingSenderId: &quot;123456789&quot;,
  appId: &quot;1:123:web:abc&quot;
}"></textarea>
          <div class="fg-hint">Copy the full config block ‚Äî with or without <code>const firebaseConfig =</code>, both work.</div>
        </div>
        <div style="display:flex;gap:10px;flex-wrap:wrap">
          <button class="fbtn fbtn-amber" onclick="connectFirebase()"><i class="ri-link"></i>Connect &amp; Go Live</button>
          <button class="fbtn fbtn-ghost" id="fb-disconnect-btn" style="display:none" onclick="disconnectFirebase()"><i class="ri-link-unlink"></i>Disconnect</button>
        </div>
        <div id="fb-err" style="display:none;margin-top:10px;background:rgba(239,68,68,.09);border:1px solid rgba(239,68,68,.25);border-radius:8px;padding:9px 13px;font-size:.8rem;color:#f87171"></div>
      </div>
      <div class="set-card">
        <div class="set-card-title">Data Management</div>
        <div style="display:flex;gap:10px;flex-wrap:wrap">
          <button class="fbtn fbtn-amber" onclick="DB.exportJSON();toast('Movies exported!','success')"><i class="ri-download-2-line"></i>Export JSON</button>
          <button class="fbtn fbtn-ghost" onclick="document.getElementById('import-input').click()"><i class="ri-upload-2-line"></i>Import JSON</button>
          <button class="fbtn fbtn-ghost" onclick="confirmReset()"><i class="ri-refresh-line"></i>Reset Defaults</button>
        </div>
        <input type="file" id="import-input" accept=".json" style="display:none" onchange="doImport(event)">
      </div>
    </div>
  </div>
</div>

<!-- ADD/EDIT MODAL -->
<div class="modal-bg" id="movie-modal">
  <div class="modal-box">
    <div class="modal-head">
      <h2 id="modal-title">Add New Movie</h2>
      <button class="modal-close" onclick="closeModal('movie-modal')"><i class="ri-close-line"></i></button>
    </div>
    <div class="modal-body">
      <input type="hidden" id="f-id">
      <div class="fgrid">
        <div class="fg"><label>Movie Title *</label><input class="fi" id="f-title" type="text" placeholder="e.g. The Dark Knight"></div>
        <div class="fg"><label>Director</label><input class="fi" id="f-director" type="text" placeholder="e.g. Christopher Nolan"></div>
      </div>
      <div class="fgrid-3">
        <div class="fg"><label>Year *</label><input class="fi" id="f-year" type="number" placeholder="2024" min="1900" max="2030"></div>
        <div class="fg"><label>Duration</label><input class="fi" id="f-duration" type="text" placeholder="2h 32m"></div>
        <div class="fg"><label>Studio</label><input class="fi" id="f-studio" type="text" placeholder="Warner Bros."></div>
      </div>
      <div class="fgrid-3">
        <div class="fg"><label>IMDb Rating</label><input class="fi" id="f-rating" type="number" placeholder="8.9" min="0" max="10" step="0.1"></div>
        <div class="fg"><label>Vote Count</label><input class="fi" id="f-votes" type="number" placeholder="524000" min="0"></div>
        <div class="fg"><label>Genres * (comma-sep.)</label><input class="fi" id="f-genres" type="text" placeholder="Action, Thriller"></div>
      </div>
      <div class="fgrid">
        <div class="fg"><label>Cast (comma-sep.)</label><input class="fi" id="f-cast" type="text" placeholder="Tom Hanks, Meryl Streep"></div>
        <div class="fg"><label>Tagline</label><input class="fi" id="f-tagline" type="text" placeholder="A short memorable tagline"></div>
      </div>
      <div class="fgrid">
        <div class="fg"><label>Short Description *</label><textarea class="fi ta" id="f-desc" placeholder="Brief overview‚Ä¶"></textarea></div>
        <div class="fg"><label>Full Description</label><textarea class="fi ta" id="f-longdesc" placeholder="Detailed description for movie page‚Ä¶"></textarea></div>
      </div>
      <div class="fgrid">
        <div class="fg">
          <label>Poster Image URL *</label>
          <input class="fi" id="f-poster" type="url" placeholder="https://image.tmdb.org/‚Ä¶/poster.jpg" oninput="previewImg('f-poster','pv-poster')">
          <div class="img-prev" id="pv-poster"><i class="ri-image-line" style="font-size:1.5rem;opacity:.3"></i><span>Poster preview</span><img src="" alt=""></div>
        </div>
        <div class="fg">
          <label>Backdrop Image URL</label>
          <input class="fi" id="f-backdrop" type="url" placeholder="https://image.tmdb.org/‚Ä¶/backdrop.jpg" oninput="previewImg('f-backdrop','pv-backdrop')">
          <div class="img-prev" id="pv-backdrop"><i class="ri-image-line" style="font-size:1.5rem;opacity:.3"></i><span>Backdrop preview</span><img src="" alt=""></div>
        </div>
      </div>
      <div class="fgrid">
        <div class="fg"><label>Watch Now URL</label><input class="fi" id="f-watch" type="url" placeholder="https://netflix.com/watch/‚Ä¶"><div class="fg-hint">External streaming link shown on the site</div></div>
        <div class="fg"><label>Download URL</label><input class="fi" id="f-download" type="url" placeholder="https://‚Ä¶/download"><div class="fg-hint">External download link</div></div>
      </div>
      <div class="fgrid">
        <div class="fg"><label>YouTube Trailer ID</label><input class="fi" id="f-trailer" type="text" placeholder="e.g. uYPbbksJxIg"><div class="fg-hint">The part after ?v= in the YouTube URL</div></div>
        <div class="fg"><label>Release Date (upcoming only)</label><input class="fi" id="f-reldate" type="date"></div>
      </div>
      <div class="fg" style="margin-bottom:12px">
        <label>Status Flags</label>
        <div class="toggles">
          <label class="tog"><input type="checkbox" id="f-featured"><span class="tog-lbl">Featured (Hero Slider)</span></label>
          <label class="tog"><input type="checkbox" id="f-new"><span class="tog-lbl">New Release</span></label>
          <label class="tog"><input type="checkbox" id="f-upcoming"><span class="tog-lbl">Upcoming Film</span></label>
        </div>
      </div>
      <div class="fg">
        <label>Card Badge</label>
        <div class="toggles">
          <label class="tog"><input type="checkbox" id="f-b-top"><span class="tog-lbl">‚òÖ Top Rated</span></label>
          <label class="tog"><input type="checkbox" id="f-b-new"><span class="tog-lbl">New</span></label>
          <label class="tog"><input type="checkbox" id="f-b-soon"><span class="tog-lbl">Coming Soon</span></label>
        </div>
      </div>
    </div>
    <div class="modal-foot">
      <button class="fbtn fbtn-ghost" onclick="closeModal('movie-modal')">Cancel</button>
      <button class="fbtn fbtn-amber" id="modal-save" onclick="saveMovie()"><i class="ri-save-line"></i>Save Movie</button>
    </div>
  </div>
</div>

<!-- CONFIRM MODAL -->
<div class="cfm-bg" id="cfm-modal">
  <div class="cfm-box">
    <div class="cfm-icon"><i class="ri-alert-line"></i></div>
    <div class="cfm-title" id="cfm-title">Are you sure?</div>
    <p class="cfm-msg" id="cfm-msg">This cannot be undone.</p>
    <div class="cfm-btns">
      <button class="fbtn fbtn-ghost" onclick="closeModal('cfm-modal')">Cancel</button>
      <button class="fbtn fbtn-red" id="cfm-yes"><i class="ri-delete-bin-line"></i>Confirm</button>
    </div>
  </div>
</div>

<div id="toasts"></div>

<!-- ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
     SCRIPTS ‚Äî Firebase ‚Üí data ‚Üí admin logic
‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê -->
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-firestore-compat.js"></script>
<script src="js/firebase-config.js"></script>
<script src="js/data.js"></script>
<script src="js/data-manager.js"></script>
<script>
/* =====================================================
   ADMIN PANEL LOGIC  ‚Äî v5 clean
   ===================================================== */

/* ‚îÄ‚îÄ CREDENTIALS (checked here, not in external file) ‚îÄ‚îÄ */
var _EMAIL = 'tuyizereomega@gmail.com';
var _PASS  = 'tuyizere123@';
var _SKEY  = 'mn_admin_sess';
var _TTL   = 8 * 60 * 60 * 1000;

var PER    = 14;
var tPage  = 1;
var editId = null;

/* ‚îÄ‚îÄ SESSION ‚îÄ‚îÄ */
function saveSession()  { localStorage.setItem(_SKEY, JSON.stringify({ts:Date.now()})) }
function killSession()  { localStorage.removeItem(_SKEY) }
function hasSession()   {
  try { var s=JSON.parse(localStorage.getItem(_SKEY)); return !!(s&&(Date.now()-s.ts<_TTL)); }
  catch(e){ return false; }
}

/* ‚îÄ‚îÄ LOGOUT ‚îÄ‚îÄ */
function doLogout() {
  try { localStorage.removeItem(_SKEY); } catch(e) {}
  document.getElementById('lockscreen').style.display = 'flex';
  document.getElementById('lock-pw').value = '';
  document.getElementById('lock-err').style.display = 'none';
  if (typeof toast === 'function') toast('Signed out.', 'info');
}

window.addEventListener('DOMContentLoaded', function() {
  /* enter-key on email ‚Üí focus password */
  document.getElementById('lock-email').addEventListener('keydown', function(e) {
    if (e.key === 'Enter') document.getElementById('lock-pw').focus();
  });
  /* enter-key on password ‚Üí login */
  document.getElementById('lock-pw').addEventListener('keydown', function(e) {
    if (e.key === 'Enter') doLogin();
  });
  /* close modals on Escape */
  document.addEventListener('keydown', function(e) {
    if (e.key === 'Escape') { closeModal('movie-modal'); closeModal('cfm-modal'); }
  });
  /* close modals on backdrop click */
  document.getElementById('movie-modal').addEventListener('click', function(e) { if(e.target===this) closeModal('movie-modal'); });
  document.getElementById('cfm-modal').addEventListener('click',   function(e) { if(e.target===this) closeModal('cfm-modal'); });
  /* mobile sidebar close on main click */
  document.getElementById('main').addEventListener('click', function() {
    if (window.innerWidth <= 800) document.getElementById('sidebar').classList.remove('open');
  });
  /* auto-login if session still valid */
  if (hasSession()) {
    document.getElementById('lockscreen').style.display = 'none';
    DB.onReady(function() { refreshAll(); renderSettings(); });
  }
});

/* ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
   NAVIGATION
‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê */
var PAGE_TITLES = { dashboard:'Dashboard', movies:'All Movies', activity:'Activity Log', settings:'Settings & Firebase' };

function goto(page) {
  document.querySelectorAll('.pg').forEach(function(p){ p.classList.remove('on'); });
  var pg = document.getElementById('pg-'+page);
  if (pg) pg.classList.add('on');
  document.querySelectorAll('.sb-btn').forEach(function(b){ b.classList.remove('on'); });
  var sb = document.querySelector('.sb-btn[onclick*="\''+page+'\'"]');
  if (sb) sb.classList.add('on');
  document.getElementById('tb-title').textContent = PAGE_TITLES[page]||page;
  if (page==='movies')   renderTable();
  if (page==='activity') renderLog();
  if (page==='settings') renderSettings();
}

/* ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
   REFRESH ALL
‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê */
function refreshAll() {
  renderDashboard();
  var cur = document.querySelector('.pg.on');
  if (cur && cur.id==='pg-movies') renderTable();
  updateCounts();
}

function updateCounts() {
  var s = DB.stats();
  setText('cnt-all',  s.total);
  setText('cnt-feat', s.featured);
  setText('cnt-up',   s.upcoming);
  setText('cnt-new',  s.newRel);
}

function setText(id, v) { var el=document.getElementById(id); if(el) el.textContent=v; }

/* ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
   DASHBOARD
‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê */
function renderDashboard() {
  var s = DB.stats();

  /* sidebar badge */
  var badge = document.getElementById('db-mode-badge');
  if (badge) {
    if (s.mode==='firestore') {
      badge.textContent='üî• LIVE';
      badge.style.background='rgba(34,197,94,.15)';
      badge.style.color='#4ade80';
    } else {
      badge.textContent='Local';
      badge.style.background='rgba(245,158,11,.15)';
      badge.style.color='var(--amb2)';
    }
  }

  var cards = [
    {n:s.total,    l:'Total Movies',   ic:'ri-film-line',        c:'ic-a'},
    {n:s.active,   l:'Active Films',   ic:'ri-play-circle-line', c:'ic-g'},
    {n:s.upcoming, l:'Upcoming',       ic:'ri-time-line',        c:'ic-b'},
    {n:s.featured, l:'Featured',       ic:'ri-star-line',        c:'ic-p'},
    {n:s.newRel,   l:'New Releases',   ic:'ri-sparkling-line',   c:'ic-g'},
    {n:s.topRated, l:'Top Rated 8+',   ic:'ri-trophy-line',      c:'ic-a'},
    {n:s.genres,   l:'Genres',         ic:'ri-list-check',       c:'ic-b'},
    {n:DB.getLogs().length, l:'Actions Logged', ic:'ri-history-line', c:'ic-p'},
  ];
  var statsEl = document.getElementById('dash-stats');
  if (statsEl) statsEl.innerHTML = cards.map(function(c){
    return '<div class="sc"><div class="sc-icon '+c.c+'"><i class="'+c.ic+'"></i></div><span class="sc-n">'+c.n+'</span><span class="sc-l">'+c.l+'</span></div>';
  }).join('');

  /* genre bars */
  var gc = {};
  DB.all().forEach(function(m){ m.genres.forEach(function(g){ gc[g]=(gc[g]||0)+1; }); });
  var sorted = Object.entries(gc).sort(function(a,b){return b[1]-a[1];}).slice(0,8);
  var max = sorted.length ? sorted[0][1] : 1;
  var gbEl = document.getElementById('genre-bars');
  if (gbEl) gbEl.innerHTML = sorted.map(function(e){
    return '<div class="gbar"><div class="gbar-top"><span>'+e[0]+'</span><span>'+e[1]+'</span></div><div class="gbar-track"><div class="gbar-fill" style="width:'+Math.round(e[1]/max*100)+'%"></div></div></div>';
  }).join('');

  /* recent */
  var recent = DB.all().slice().reverse().slice(0,6);
  var rlEl = document.getElementById('recent-list');
  if (rlEl) rlEl.innerHTML = recent.map(function(m){
    return '<div class="rl-item" onclick="editMovie('+m.id+')"><img class="rl-img" src="'+m.poster+'" onerror="this.src=\'https://placehold.co/34x50/161f2e/f59e0b?text=?\'" alt=""><div class="rl-info"><div class="rl-title">'+esc(m.title)+'</div><div class="rl-meta">'+m.year+' ¬∑ '+(m.genres[0]||'‚Äî')+'</div></div><i class="ri-pencil-line" style="color:var(--muted2);font-size:.82rem;flex-shrink:0"></i></div>';
  }).join('');

  renderLogTo('dash-log', 10);
  updateCounts();
}

/* ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
   MOVIES TABLE
‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê */
function renderTable() {
  var q      = (document.getElementById('tbl-q')||{value:''}).value.trim().toLowerCase();
  var status = (document.getElementById('tbl-status')||{value:''}).value;
  var genre  = (document.getElementById('tbl-genre')||{value:''}).value;

  /* populate genre filter once */
  var gSel = document.getElementById('tbl-genre');
  if (gSel && gSel.options.length <= 1) {
    var gs = [];
    DB.all().forEach(function(m){ m.genres.forEach(function(g){ if(!gs.includes(g)) gs.push(g); }); });
    gs.sort().forEach(function(g){ var o=document.createElement('option'); o.value=o.textContent=g; gSel.appendChild(o); });
  }

  var mv = DB.all();
  if (q)               mv = mv.filter(function(m){ return m.title.toLowerCase().includes(q)||(m.director||'').toLowerCase().includes(q); });
  if (status==='featured') mv = mv.filter(function(m){ return m.featured; });
  if (status==='new')      mv = mv.filter(function(m){ return m.isNew; });
  if (status==='upcoming') mv = mv.filter(function(m){ return m.upcoming; });
  if (status==='top')      mv = mv.filter(function(m){ return m.rating>=8; });
  if (genre)           mv = mv.filter(function(m){ return m.genres.includes(genre); });

  var total = mv.length;
  var pages = Math.max(1, Math.ceil(total/PER));
  tPage = Math.min(tPage, pages);
  var slice = mv.slice((tPage-1)*PER, tPage*PER);

  var body  = document.getElementById('tbl-body');
  var empty = document.getElementById('tbl-empty');
  if (!slice.length) {
    if (body) body.innerHTML='';
    if (empty) empty.style.display='block';
  } else {
    if (empty) empty.style.display='none';
    if (body) body.innerHTML = slice.map(function(m){
      var bc = m.upcoming?'bd-soon':m.badge==='top'?'bd-top':m.isNew?'bd-new':m.featured?'bd-feat':'bd-none';
      var bt = m.upcoming?'Upcoming':m.badge==='top'?'Top Rated':m.isNew?'New Release':m.featured?'Featured':'‚Äî';
      var safeTitle = esc(m.title).replace(/'/g,'&#39;');
      return '<tr>'
        +'<td><img class="td-poster" src="'+m.poster+'" onerror="this.src=\'https://placehold.co/34x50/161f2e/f59e0b?text=?\'" alt=""></td>'
        +'<td><div class="td-title" title="'+esc(m.title)+'">'+esc(m.title)+'</div><div class="td-sub">'+esc(m.director||'‚Äî')+'</div></td>'
        +'<td>'+m.year+'</td>'
        +'<td><div class="td-genres">'+m.genres.slice(0,3).map(function(g){return'<span class="td-genre">'+g+'</span>';}).join('')+'</div></td>'
        +'<td class="td-rating">'+(m.rating?'‚≠ê '+m.rating:'‚Äî')+'</td>'
        +'<td><span class="td-badge '+bc+'">'+bt+'</span></td>'
        +'<td class="td-actions">'
          +'<button class="act act-view" title="View on site" onclick="window.open(\'movie.html?id='+m.id+'\',\'_blank\')"><i class="ri-eye-line"></i></button>'
          +'<button class="act act-feat'+(m.featured?' is-feat':'')+'" title="Toggle featured" onclick="toggleFeat('+m.id+',this)"><i class="ri-star-'+(m.featured?'fill':'line')+'"></i></button>'
          +'<button class="act act-edit" title="Edit" onclick="editMovie('+m.id+')"><i class="ri-pencil-line"></i></button>'
          +'<button class="act act-del" title="Delete" onclick="delMovie('+m.id+',\''+safeTitle+'\')"><i class="ri-delete-bin-line"></i></button>'
        +'</td>'
        +'</tr>';
    }).join('');
  }

  /* pagination */
  var infoEl = document.getElementById('pg-info');
  if (infoEl) infoEl.textContent = total+' movie'+(total!==1?'s':'')+' ¬∑ Page '+tPage+' of '+pages;
  var pb = document.getElementById('pg-btns');
  if (!pb) return;
  pb.innerHTML='';
  function mkBtn(html, pg, dis) {
    var b=document.createElement('button'); b.className='pg-btn'+(pg===tPage?' on':'');
    b.innerHTML=html; b.disabled=!!dis;
    if (!dis) b.onclick=function(){ tPage=pg; renderTable(); };
    pb.appendChild(b);
  }
  mkBtn('<i class="ri-arrow-left-s-line"></i>', tPage-1, tPage<=1);
  pgRange(tPage,pages).forEach(function(p){
    if(p==='‚Ä¶') pb.insertAdjacentHTML('beforeend','<span style="display:flex;align-items:center;padding:0 3px;color:var(--muted2);font-size:.8rem">‚Ä¶</span>');
    else mkBtn(p,p);
  });
  mkBtn('<i class="ri-arrow-right-s-line"></i>', tPage+1, tPage>=pages);
}

function pgRange(cur,total){
  if(total<=7){ var r=[]; for(var i=1;i<=total;i++) r.push(i); return r; }
  if(cur<=4)  return [1,2,3,4,5,'‚Ä¶',total];
  if(cur>=total-3) return [1,'‚Ä¶',total-4,total-3,total-2,total-1,total];
  return [1,'‚Ä¶',cur-1,cur,cur+1,'‚Ä¶',total];
}

function setFilter(val) {
  var el=document.getElementById('tbl-status'); if(el) el.value=val;
  tPage=1; renderTable();
}

/* ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
   FEATURED TOGGLE
‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê */
function toggleFeat(id, btn) {
  try {
    var LS_KEY = 'mn_movies_db';
    var arr = JSON.parse(localStorage.getItem(LS_KEY) || 'null') || MOVIES.slice();
    var idx = arr.findIndex(function(m){ return m.id === +id; });
    if (idx === -1) { toast('Movie not found.','error'); return; }
    arr[idx].featured = !arr[idx].featured;
    localStorage.setItem(LS_KEY, JSON.stringify(arr));
    var isFeat = arr[idx].featured;
    btn.className = 'act act-feat' + (isFeat ? ' is-feat' : '');
    btn.querySelector('i').className = 'ri-star-' + (isFeat ? 'fill' : 'line');
    toast((isFeat ? 'Added to' : 'Removed from') + ' hero slider!', 'success');
    DB.init();
    DB.onReady(function(){ renderDashboard(); });
    /* sync to Firestore in background */
    if (window.MN_FIRESTORE) {
      window.MN_FIRESTORE.collection('movies').doc(String(id)).update({featured: isFeat}).catch(function(){});
    }
  } catch(e) { toast('Error: '+e.message,'error'); }
}

/* ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
   ADD / EDIT MOVIE
‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê */
function openAdd() {
  editId=null;
  document.getElementById('modal-title').textContent='Add New Movie';
  document.getElementById('modal-save').innerHTML='<i class="ri-add-line"></i>Add Movie';
  ['f-id','f-title','f-director','f-year','f-duration','f-studio','f-rating','f-votes',
   'f-genres','f-cast','f-tagline','f-desc','f-longdesc','f-poster','f-backdrop',
   'f-watch','f-download','f-trailer','f-reldate'].forEach(function(id){
    var el=document.getElementById(id); if(el) el.value='';
  });
  ['f-featured','f-new','f-upcoming','f-b-top','f-b-new','f-b-soon'].forEach(function(id){
    var el=document.getElementById(id); if(el) el.checked=false;
  });
  clearPreviews();
  openModal('movie-modal');
}

function editMovie(id) {
  var m=DB.byId(id);
  if (!m){ toast('Movie not found.','error'); return; }
  editId=id;
  document.getElementById('modal-title').textContent='Edit Movie';
  document.getElementById('modal-save').innerHTML='<i class="ri-save-line"></i>Save Changes';
  function sv(i,v){ var el=document.getElementById(i); if(el) el.value=v||''; }
  sv('f-id',m.id); sv('f-title',m.title); sv('f-director',m.director);
  sv('f-year',m.year); sv('f-duration',m.duration); sv('f-studio',m.studio);
  sv('f-rating',m.rating||''); sv('f-votes',m.votes||'');
  sv('f-genres',(m.genres||[]).join(', ')); sv('f-cast',(m.cast||[]).join(', '));
  sv('f-tagline',m.tagline); sv('f-desc',m.desc); sv('f-longdesc',m.longDesc);
  sv('f-poster',m.poster); sv('f-backdrop',m.backdrop);
  sv('f-watch',m.watchUrl); sv('f-download',m.downloadUrl);
  sv('f-trailer',m.trailer); sv('f-reldate',m.releaseDate||'');
  function sc(i,v){ var el=document.getElementById(i); if(el) el.checked=!!v; }
  sc('f-featured',m.featured); sc('f-new',m.isNew); sc('f-upcoming',m.upcoming);
  sc('f-b-top',m.badge==='top'); sc('f-b-new',m.badge==='new'); sc('f-b-soon',m.badge==='soon');
  if(m.poster)   previewImg('f-poster','pv-poster');
  if(m.backdrop) previewImg('f-backdrop','pv-backdrop');
  openModal('movie-modal');
}

function saveMovie() {
  var title  = gv('f-title').trim();
  var year   = gv('f-year').trim();
  var genres = gv('f-genres').trim();
  var desc   = gv('f-desc').trim();
  var poster = gv('f-poster').trim();
  if (!title)  { toast('Title is required.','error'); return; }
  if (!year)   { toast('Year is required.','error'); return; }
  if (!genres) { toast('At least one genre is required.','error'); return; }
  if (!desc)   { toast('Description is required.','error'); return; }
  if (!poster) { toast('Poster URL is required.','error'); return; }

  var badge = '';
  if (document.getElementById('f-b-top').checked)  badge = 'top';
  if (document.getElementById('f-b-new').checked)  badge = 'new';
  if (document.getElementById('f-b-soon').checked) badge = 'soon';

  var data = {
    title:    title,
    year:     +year,
    director: gv('f-director'),
    duration: gv('f-duration') || 'TBA',
    studio:   gv('f-studio'),
    rating:   gv('f-rating') ? +gv('f-rating') : null,
    votes:    +gv('f-votes') || 0,
    genres:   genres.split(',').map(function(s){ return s.trim(); }).filter(Boolean),
    cast:     gv('f-cast').split(',').map(function(s){ return s.trim(); }).filter(Boolean),
    castImg:  editId ? ((DB.byId(editId)||{}).castImg||[]) : [],
    tagline:  gv('f-tagline'),
    desc:     desc,
    longDesc: gv('f-longdesc'),
    poster:   poster,
    backdrop: gv('f-backdrop'),
    watchUrl: gv('f-watch'),
    downloadUrl: gv('f-download'),
    trailer:  gv('f-trailer'),
    releaseDate: gv('f-reldate') || null,
    featured: document.getElementById('f-featured').checked,
    isNew:    document.getElementById('f-new').checked,
    upcoming: document.getElementById('f-upcoming').checked,
    badge:    badge
  };

  /* ‚îÄ‚îÄ SAVE DIRECTLY TO LOCALSTORAGE (synchronous, never hangs) ‚îÄ‚îÄ */
  try {
    var LS_KEY  = 'mn_movies_db';
    var META_KEY = 'mn_meta';
    var arr = JSON.parse(localStorage.getItem(LS_KEY) || 'null') || MOVIES.slice();

    if (editId) {
      /* UPDATE */
      var idx = arr.findIndex(function(m){ return m.id === +editId; });
      if (idx === -1) { toast('Movie not found ‚Äî try refreshing.','error'); return; }
      data.id = +editId;
      arr[idx] = data;
    } else {
      /* ADD ‚Äî get next id */
      var meta = JSON.parse(localStorage.getItem(META_KEY) || '{}');
      var nextId = meta.nextId || (Math.max.apply(null, arr.map(function(m){return m.id||0;}).concat([0])) + 1);
      data.id = nextId;
      meta.nextId = nextId + 1;
      localStorage.setItem(META_KEY, JSON.stringify(meta));
      arr.push(data);
    }

    localStorage.setItem(LS_KEY, JSON.stringify(arr));

    /* log the action */
    var logKey = 'mn_activity';
    var logs = JSON.parse(localStorage.getItem(logKey) || '[]');
    logs.unshift({ action: editId ? 'Updated' : 'Added', title: title, ts: new Date().toISOString() });
    if (logs.length > 100) logs.length = 100;
    localStorage.setItem(logKey, JSON.stringify(logs));

    toast('"' + title + '" ' + (editId ? 'updated' : 'added') + ' successfully! ‚úì', 'success');
    closeModal('movie-modal');

    /* re-init DB cache from localStorage so table refreshes correctly */
    var savedId = editId;
    editId = null;
    DB.init();
    DB.onReady(function(){ refreshAll(); });

    /* also push to Firestore in background if connected (non-blocking) */
    if (window.MN_FIRESTORE) {
      window.MN_FIRESTORE.collection('movies').doc(String(data.id)).set(data)
        .then(function(){ toast('"'+title+'" is now LIVE on your website! üî•','success'); })
        .catch(function(e){ console.warn('Firestore sync failed (local save succeeded):', e.message); });
    }

  } catch(err) {
    toast('Save failed: ' + err.message, 'error');
  }
}

/* ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
   DELETE
‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê */
function delMovie(id, title) {
  confirm2('Delete Movie?', 'Delete "'+title+'"? This cannot be undone.', 'Delete', function(){
    try {
      var LS_KEY = 'mn_movies_db';
      var arr = JSON.parse(localStorage.getItem(LS_KEY) || 'null') || MOVIES.slice();
      arr = arr.filter(function(m){ return m.id !== +id; });
      localStorage.setItem(LS_KEY, JSON.stringify(arr));
      var logs = JSON.parse(localStorage.getItem('mn_activity') || '[]');
      logs.unshift({ action:'Deleted', title:title, ts:new Date().toISOString() });
      localStorage.setItem('mn_activity', JSON.stringify(logs));
      toast('"'+title+'" deleted.','info');
      DB.init();
      DB.onReady(function(){ refreshAll(); });
      /* sync to Firestore */
      if (window.MN_FIRESTORE) {
        window.MN_FIRESTORE.collection('movies').doc(String(id)).delete().catch(function(){});
      }
    } catch(e) { toast('Delete failed: '+e.message,'error'); }
  });
}

/* ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
   CONFIRM DIALOG
‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê */
function confirm2(title, msg, btnTxt, onYes) {
  document.getElementById('cfm-title').textContent=title;
  document.getElementById('cfm-msg').innerHTML=msg;
  var yes=document.getElementById('cfm-yes');
  yes.innerHTML='<i class="ri-delete-bin-line"></i>'+btnTxt;
  yes.onclick=function(){ onYes(); closeModal('cfm-modal'); };
  openModal('cfm-modal');
}

/* ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
   RESET / IMPORT
‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê */
function confirmReset(){
  confirm2('Reset to Defaults?','Remove all custom movies and restore the original list?','Reset', function(){
    DB.reset().then(function(){ refreshAll(); toast('Reset to defaults.','warn'); }).catch(function(e){ toast(e.message,'error'); });
  });
}
function doImport(e){
  var file=e.target.files[0]; if(!file) return;
  var r=new FileReader();
  r.onload=function(ev){
    try{
      var data=JSON.parse(ev.target.result);
      if(!Array.isArray(data)) throw new Error('Not an array');
      localStorage.setItem('mn_movies_db',JSON.stringify(data));
      DB.init(); refreshAll();
      toast('Imported '+data.length+' movies!','success');
    }catch(err){ toast('Invalid JSON file.','error'); }
  };
  r.readAsText(file);
  e.target.value='';
}

/* ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
   ACTIVITY LOG
‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê */
function renderLog(){
  renderLogTo('full-log',500);
  var el=document.getElementById('log-cnt');
  if(el) el.textContent=DB.getLogs().length+' entries';
}
function renderLogTo(id,limit){
  var logs=DB.getLogs().slice(0,limit);
  var el=document.getElementById(id); if(!el) return;
  if(!logs.length){ el.innerHTML='<div style="padding:16px;color:var(--muted2);font-size:.84rem;text-align:center">No activity yet.</div>'; return; }
  el.innerHTML=logs.map(function(l){
    var cls=l.action==='Added'?'la':l.action==='Deleted'?'ld':l.action==='Reset'?'lr':'lu';
    return '<div class="li '+cls+'"><div class="li-dot"></div><span class="li-act">'+l.action+'</span><span class="li-movie">'+esc(l.title)+'</span><span class="li-ts">'+timeAgo(new Date(l.ts))+'</span></div>';
  }).join('');
}
function clearLog(){
  confirm2('Clear Log?','Delete all activity history?','Clear',function(){
    localStorage.removeItem('mn_activity');
    renderLog(); renderDashboard(); toast('Log cleared.','info');
  });
}

/* ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
   SETTINGS PAGE
‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê */
function renderSettings(){
  var isFS=DB.isFirestore();
  var hasSaved=!!localStorage.getItem('mn_fb_config');

  /* status card */
  var el=document.getElementById('db-status-msg'); if(!el) return;
  if(isFS){
    el.innerHTML='<div style="display:flex;align-items:center;gap:11px;padding:13px;background:rgba(34,197,94,.08);border:1px solid rgba(34,197,94,.2);border-radius:var(--r)">'
      +'<span style="font-size:1.6rem">üî•</span>'
      +'<div><strong style="color:var(--green);display:block;margin-bottom:3px">Firebase Firestore Connected ‚Äî LIVE</strong>'
      +'<span style="font-size:.8rem;color:var(--muted)">Every change you make appears instantly on your website for all visitors worldwide.</span></div></div>';
  } else {
    el.innerHTML='<div style="display:flex;align-items:center;gap:11px;padding:13px;background:rgba(245,158,11,.07);border:1px solid rgba(245,158,11,.2);border-radius:var(--r)">'
      +'<span style="font-size:1.6rem">‚ö†Ô∏è</span>'
      +'<div><strong style="color:var(--amb2);display:block;margin-bottom:3px">Local Storage ‚Äî Not Live</strong>'
      +'<span style="font-size:.8rem;color:var(--muted)">Changes are in this browser only. Connect Firebase below to push all changes live.</span></div></div>';
  }

  /* disconnect button */
  var disc=document.getElementById('fb-disconnect-btn');
  if(disc) disc.style.display=(isFS||hasSaved)?'inline-flex':'none';

  /* pre-fill saved config */
  if(hasSaved){
    var ta=document.getElementById('fb-paste');
    if(ta && !ta.value) {
      try{ ta.value=JSON.stringify(JSON.parse(localStorage.getItem('mn_fb_config')),null,2); }catch(e){}
    }
  }
}

/* ‚îÄ‚îÄ Connect Firebase ‚îÄ‚îÄ */
function connectFirebase(){
  var raw=(document.getElementById('fb-paste').value||'').trim();
  var errEl=document.getElementById('fb-err'); errEl.style.display='none';
  if(!raw){ showFbErr('Please paste your Firebase config first.'); return; }

  /* extract JSON object */
  var match=raw.match(/\{[\s\S]*\}/);
  if(!match){ showFbErr('Cannot find a { } block. Make sure you copy the full config object.'); return; }
  var jsonStr=match[0];

  var cfg;
  try{
    /* turn JS bare keys into quoted keys for JSON.parse */
    jsonStr=jsonStr.replace(/([{,]\s*)([a-zA-Z_$][a-zA-Z0-9_$]*)(\s*:)/g,'$1"$2"$3');
    /* remove trailing commas */
    jsonStr=jsonStr.replace(/,(\s*[}\]])/g,'$1');
    cfg=JSON.parse(jsonStr);
  }catch(e){ showFbErr('Could not parse config. Copy the entire { ... } block from Firebase console.'); return; }

  var missing=['apiKey','projectId','appId'].filter(function(k){ return !cfg[k]||String(cfg[k]).startsWith('YOUR_'); });
  if(missing.length){ showFbErr('Missing fields: '+missing.join(', ')+'. Copy the full config from Firebase.'); return; }

  localStorage.setItem('mn_fb_config',JSON.stringify(cfg));
  toast('Firebase config saved! Reloading to connect‚Ä¶','success');
  setTimeout(function(){ location.reload(); }, 900);
}

function disconnectFirebase(){
  confirm2('Disconnect Firebase?','Switch back to local storage. Your Firestore data stays safe.','Disconnect',function(){
    localStorage.removeItem('mn_fb_config');
    toast('Disconnected. Reloading‚Ä¶','info');
    setTimeout(function(){ location.reload(); }, 700);
  });
}
function showFbErr(msg){ var e=document.getElementById('fb-err'); e.textContent=msg; e.style.display='block'; }

/* ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
   IMAGE PREVIEW
‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê */
function previewImg(inputId,prevId){
  var url=(document.getElementById(inputId)||{}).value||'';
  var wrap=document.getElementById(prevId); if(!wrap) return;
  var img=wrap.querySelector('img'); if(!img) return;
  img.src=url;
  img.onload=function(){ wrap.classList.add('has'); };
  img.onerror=function(){ wrap.classList.remove('has'); };
}
function clearPreviews(){
  ['pv-poster','pv-backdrop'].forEach(function(id){
    var w=document.getElementById(id); if(!w) return;
    w.classList.remove('has');
    var i=w.querySelector('img'); if(i) i.src='';
  });
}

/* ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
   MODAL HELPERS
‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê */
function openModal(id){
  var el=document.getElementById(id);
  if(el){ el.classList.add('open'); document.body.style.overflow='hidden'; }
}
function closeModal(id){
  var el=document.getElementById(id);
  if(el){ el.classList.remove('open'); document.body.style.overflow=''; }
}

/* ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
   TOAST
‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê */
function toast(msg,type){
  type=type||'info';
  var c=document.getElementById('toasts'); if(!c) return;
  var icons={success:'ri-checkbox-circle-fill',error:'ri-close-circle-fill',info:'ri-information-fill',warn:'ri-alert-fill'};
  var t=document.createElement('div');
  t.className='toast '+type;
  t.innerHTML='<i class="'+(icons[type]||icons.info)+'"></i><span>'+msg+'</span>';
  c.appendChild(t);
  setTimeout(function(){
    t.style.transition='opacity .4s,transform .4s';
    t.style.opacity='0'; t.style.transform='translateX(110%)';
    setTimeout(function(){ t.remove(); },420);
  },3800);
}

/* ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
   UTILS
‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê */
function esc(s){ return String(s||'').replace(/&/g,'&amp;').replace(/</g,'&lt;').replace(/>/g,'&gt;').replace(/"/g,'&quot;'); }
function gv(id){ return (document.getElementById(id)||{value:''}).value||''; }
function timeAgo(d){
  var s=Math.floor((Date.now()-d)/1000);
  if(s<60)    return 'just now';
  if(s<3600)  return Math.floor(s/60)+'m ago';
  if(s<86400) return Math.floor(s/3600)+'h ago';
  return Math.floor(s/86400)+'d ago';
}
</script>
</body>
</html>
